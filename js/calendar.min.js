/*! calendar - v0.0.4-0.2.4 - 2015-06-10 - https://github.com/Serhioromano/bootstrap-calendar */
!function(){"use strict";function a(a){var b=new Date(a.getFullYear(),0,1);return Math.ceil(((a.getTime()-b.getTime())/864e5+b.getDay()+1)/7)}function b(a){var b=a.getMonth()+1;return 10>b?"0"+b:b}function c(a){var a=a.getDate();return 10>a?"0"+a:a}function d(a){var b=$.makeArray(arguments).slice(1);return a.replace(/{(\d+)}/g,function(a,c){return"undefined"!=typeof b[c]?b[c]:a})}function e(a,b){for(var b=b||2,c=""+a;c.length<b;)c="0"+c;return c}function f(f,g,h,i){function j(a,b){var c,d,e;e=a,c=a.indexOf("?")<0?"?":"&";for(d in b)e+=c+d+"="+encodeURIComponent(b[d]),c="&";return e}function k(a,b){var c=null!=a.options[b]?a.options[b]:null,d=null!=a.locale[b]?a.locale[b]:null;if("holidays"==b&&a.options.merge_holidays){var e={};return f.extend(!0,e,d?d:q.holidays),c&&f.extend(!0,e,c),e}return null!=c?c:null!=d?d:q[b]}function l(a,b){var c=[],d=k(a,"holidays");for(var e in d)c.push(e+":"+d[e]);if(c.push(b),c=c.join("|"),c in l.cache)return l.cache[c];var g=[];return f.each(d,function(a,c){var d=null,e=null,h=!1;if(f.each(a.split(">"),function(c,f){var g,i=null;if(g=/^(\d\d)-(\d\d)$/.exec(f))i=new Date(b,parseInt(g[2],10)-1,parseInt(g[1],10));else if(g=/^(\d\d)-(\d\d)-(\d\d\d\d)$/.exec(f))parseInt(g[3],10)==b&&(i=new Date(b,parseInt(g[2],10)-1,parseInt(g[1],10)));else if(g=/^easter(([+\-])(\d+))?$/.exec(f))i=o(b,g[1]?parseInt(g[1],10):0);else if(g=/^(\d\d)([+\-])([1-5])\*([0-6])$/.exec(f)){var j=parseInt(g[1],10)-1,k=g[2],l=parseInt(g[3]),n=parseInt(g[4]);switch(k){case"+":for(var p=new Date(b,j,-6);p.getDay()!=n;)p=new Date(p.getFullYear(),p.getMonth(),p.getDate()+1);i=new Date(p.getFullYear(),p.getMonth(),p.getDate()+7*l);break;case"-":for(var p=new Date(b,j+1,7);p.getDay()!=n;)p=new Date(p.getFullYear(),p.getMonth(),p.getDate()-1);i=new Date(p.getFullYear(),p.getMonth(),p.getDate()-7*l)}}if(!i)return m("Unknown holiday: "+a),h=!0,!1;switch(c){case 0:d=i;break;case 1:if(i.getTime()<=d.getTime())return m("Unknown holiday: "+a),h=!0,!1;e=i;break;default:return m("Unknown holiday: "+a),h=!0,!1}}),!h){var i=[];if(e)for(var j=new Date(d.getTime());j.getTime()<=e.getTime();j.setDate(j.getDate()+1))i.push(new Date(j.getTime()));else i.push(d);g.push({name:c,days:i})}}),l.cache[c]=g,l.cache[c]}function m(a){"object"==f.type(window.console)&&"function"==f.type(window.console.warn)&&window.console.warn("[Calendar] "+a)}function n(a,b,c,d){a.stopPropagation();var b=f(b),e=b.closest(".cal-cell"),g=e.closest(".cal-before-eventlist"),h=e.data("cal-row");b.fadeOut("fast"),c.slideUp("fast",function(){var a=f(".events-list",e);c.html(d.options.templates["events-list"]({cal:d,events:d.getEventsBetween(parseInt(a.data("cal-start")),parseInt(a.data("cal-end")))})),g.after(c),d.activecell=d.context.find("[data-cal-date]",e).text(),d.context.find(".cal-slide-tick").addClass("tick"+h).show(),c.slideDown("fast",function(){f("body").one("click",function(){c.slideUp("fast"),d.activecell=0})})})}function o(a,b){var c=a%19,d=Math.floor(a/100),e=a%100,f=Math.floor(d/4),g=d%4,h=Math.floor((d+8)/25),i=Math.floor((d-h+1)/3),j=(19*c+d-f-i+15)%30,k=Math.floor(e/4),l=e%4,m=(32+2*g+2*k-j-l)%7,n=Math.floor((c+11*j+22*m)/451),o=j+m+7*n+114,p=Math.floor(o/31)-1,q=o%31+1;return new Date(a,p,q+(b?b:0),0,0,0)}var p={width:"100%",view:"month",day:"now",time_start:"06:00",time_end:"22:00",time_split:"30",events_source:"",tmpl_path:"tmpls/",tmpl_cache:!0,classes:{months:{inmonth:"cal-day-inmonth",outmonth:"cal-day-outmonth",saturday:"cal-day-weekend",sunday:"cal-day-weekend",holidays:"cal-day-holiday",today:"cal-day-today"},week:{workday:"cal-day-workday",saturday:"cal-day-weekend",sunday:"cal-day-weekend",holidays:"cal-day-holiday",today:"cal-day-today"}},views:{year:{slide_events:1,enable:1},month:{slide_events:1,enable:1},week:{enable:1},day:{enable:1}},merge_holidays:!1,onAfterEventsLoad:function(){},onBeforeEventsLoad:function(a){a()},onAfterViewLoad:function(){},onAfterModalShown:function(){},onAfterModalHidden:function(){},events:[],templates:{year:"",month:"",week:"",day:""},stop_cycling:!1},q={first_day:2,holidays:{"01-01":"New Year's Day","01+3*1":"Birthday of Dr. Martin Luther King, Jr.","02+3*1":"Washington's Birthday","05-1*1":"Memorial Day","04-07":"Independence Day","09+1*1":"Labor Day","10+2*1":"Columbus Day","11-11":"Veterans Day","11+4*4":"Thanksgiving Day","25-12":"Christmas"}},r={error_noview:"Calendar: View {0} not found",error_dateformat:'Calendar: Wrong date format {0}. Should be either "now" or "yyyy-mm-dd"',error_loadurl:"Calendar: Event URL is not set",error_where:'Calendar: Wrong navigation direction {0}. Can be only "next" or "prev" or "today"',error_timedevide:"Calendar: Time split parameter should divide 60 without decimals. Something like 10, 15, 30",no_events_in_day:"No events in this day.",title_year:"{0}",title_month:"{0} {1}",title_week:"week {0} of {1}",title_day:"{0} {1} {2}, {3}",week:"Week {0}",all_day:"All day",time:"Time",events:"Events",before_time:"Ends before timeline",after_time:"Starts after timeline",m0:"January",m1:"February",m2:"March",m3:"April",m4:"May",m5:"June",m6:"July",m7:"August",m8:"September",m9:"October",m10:"November",m11:"December",ms0:"Jan",ms1:"Feb",ms2:"Mar",ms3:"Apr",ms4:"May",ms5:"Jun",ms6:"Jul",ms7:"Aug",ms8:"Sep",ms9:"Oct",ms10:"Nov",ms11:"Dec",d0:"Sunday",d1:"Monday",d2:"Tuesday",d3:"Wednesday",d4:"Thursday",d5:"Friday",d6:"Saturday"},s="";try{"object"==f.type(window.jstz)&&"function"==f.type(jstz.determine)&&(s=jstz.determine().name(),"string"!==f.type(s)&&(s=""))}catch(t){}l.cache={};var u={init:function(){this.options.position=f.extend(!0,{},{start:new Date,end:new Date},this.options.position||{}),this.setLanguage(this.options.language),this.context.css("width",this.options.width).addClass("cal-context"),this.view()},setOptions:function(a){f.extend(this.options,a),"language"in a&&this.setLanguage(a.language)},setLanguage:function(a){window.calendar_languages&&a in window.calendar_languages?(this.locale=f.extend(!0,{},r,calendar_languages[a]),this.options.language=a):(this.locale=r,delete this.options.language)},_render:function(){this.context.html(""),this._loadTemplate(this.options.view),this.stop_cycling=!1;var a={};a.cal=this,a.day=1,a.days_name=1==k(this,"first_day")?[this.locale.d1,this.locale.d2,this.locale.d3,this.locale.d4,this.locale.d5,this.locale.d6,this.locale.d0]:[this.locale.d0,this.locale.d1,this.locale.d2,this.locale.d3,this.locale.d4,this.locale.d5,this.locale.d6];var b=parseInt(this.options.position.start.getTime()),c=parseInt(this.options.position.end.getTime());switch(a.events=this.getEventsBetween(b,c),this.options.view){case"month":break;case"week":this._calculate_hour_minutes(a);break;case"day":this._calculate_hour_minutes(a)}a.start=new Date(this.options.position.start.getTime()),a.lang=this.locale,this.context.append(this.options.templates[this.options.view](a)),this._update()},_calculate_hour_minutes:function(a){var b=this,c=parseInt(this.options.time_split),d=60/c,g=Math.min(d,1);(d>=1&&d%1!=0||1>d&&1440/c%1!=0)&&f.error(this.locale.error_timedevide);var h=this.options.time_start.split(":"),i=this.options.time_end.split(":");a.hours=(parseInt(i[0])-parseInt(h[0]))*g;var j=a.hours*d-parseInt(h[1])/c,k=6e4*c,l=new Date(this.options.position.start.getTime());l.setHours(h[0]),l.setMinutes(h[1]);var n=new Date(this.options.position.end.getTime());n.setHours(i[0]),n.setMinutes(i[1]),a.all_day=[],a.by_hour=[],a.after_time=[],a.before_time=[],f.each(a.events,function(c,d){var f=new Date(parseInt(d.start)),g=new Date(parseInt(d.end));if(d.start_hour=e(f.getHours().toString())+":"+e(f.getMinutes().toString()),d.end_hour=e(g.getHours().toString())+":"+e(g.getMinutes().toString()),d.start<l.getTime()&&(m(1),d.start_hour=f.getDate()+" "+b.locale["ms"+f.getMonth()]+" "+d.start_hour),d.end>n.getTime()&&(m(1),d.end_hour=g.getDate()+" "+b.locale["ms"+g.getMonth()]+" "+d.end_hour),d.start<l.getTime()&&d.end>n.getTime())return void a.all_day.push(d);if(d.end<l.getTime())return void a.before_time.push(d);if(d.start>n.getTime())return void a.after_time.push(d);var h=l.getTime()-d.start;d.top=h>=0?0:Math.abs(h)/k;var i=Math.abs(j-d.top),o=(d.end-d.start)/k;h>=0&&(o=(d.end-l.getTime())/k),d.lines=o,o>i&&(d.lines=i),a.by_hour.push(d)})},_hour_min:function(a){var b=this.options.time_start.split(":"),c=parseInt(this.options.time_split),d=60/c;return 0==a?d-parseInt(b[1])/c:d},_hour:function(a,b){var c=this.options.time_start.split(":"),d=parseInt(this.options.time_split),f=""+(parseInt(c[0])+a*Math.max(d/60,1)),g=""+(d*b+(0==a?parseInt(c[1]):0));return e(f)+":"+e(g)},_week:function(){this._loadTemplate("week-days");var a={},b=parseInt(this.options.position.start.getTime()),c=parseInt(this.options.position.end.getTime()),d=[],e=this,g=k(this,"first_day");return f.each(this.getEventsBetween(b,c),function(a,c){c.start_day=new Date(parseInt(c.start)).getDay(),1==g&&(c.start_day=(c.start_day+6)%7),c.days=c.end-c.start<=864e5?1:(c.end-c.start)/864e5,c.start<b&&(c.days=c.days-(b-c.start)/864e5,c.start_day=0),c.days=Math.ceil(c.days),c.start_day+c.days>7&&(c.days=7-c.start_day),d.push(c)}),a.events=d,a.cal=this,e.options.templates["week-days"](a)},_month:function(a){this._loadTemplate("year-month");var b={cal:this},c=a+1;b.data_day=this.options.position.start.getFullYear()+"-"+(10>c?"0"+c:c)+"-01",b.month_name=this.locale["m"+a];var d=new Date(this.options.position.start.getFullYear(),a,1,0,0,0);return b.start=parseInt(d.getTime()),b.end=parseInt(new Date(this.options.position.start.getFullYear(),a+1,1,0,0,0).getTime()),b.events=this.getEventsBetween(b.start,b.end),this.options.templates["year-month"](b)},_day:function(a,c){this._loadTemplate("month-day");var d={tooltip:"",cal:this},e=this.options.classes.months.outmonth,g=this.options.position.start.getDay();2==k(this,"first_day")?g++:g=0==g?7:g,c=c-g+1;var h=new Date(this.options.position.start.getFullYear(),this.options.position.start.getMonth(),c,0,0,0);c>0&&(e=this.options.classes.months.inmonth);var i=new Date(this.options.position.end.getTime()-1).getDate();if(c+1>i&&(this.stop_cycling=!0),c>i&&(c-=i,e=this.options.classes.months.outmonth),e=f.trim(e+" "+this._getDayClass("months",h)),0>=c){var j=new Date(this.options.position.start.getFullYear(),this.options.position.start.getMonth(),0).getDate();c=j-Math.abs(c),e+=" cal-month-first-row"}var l=this._getHoliday(h);return l!==!1&&(d.tooltip=l),d.data_day=h.getFullYear()+"-"+b(h)+"-"+(10>c?"0"+c:c),d.cls=e,d.day=c,d.start=parseInt(h.getTime()),d.end=parseInt(d.start+864e5),d.events=this.getEventsBetween(d.start,d.end),this.options.templates["month-day"](d)},_getHoliday:function(a){var b=!1;return f.each(l(this,a.getFullYear()),function(){var c=!1;return f.each(this.days,function(){return this.toDateString()==a.toDateString()?(c=!0,!1):void 0}),c?(b=this.name,!1):void 0}),b},_getHolidayName:function(a){var b=this._getHoliday(a);return b===!1?"":b},_getDayClass:function(a,b){var c=this,d=function(b,d){var e;e=c.options.classes&&a in c.options.classes&&b in c.options.classes[a]?c.options.classes[a][b]:"","string"==typeof e&&e.length&&d.push(e)},e=[];b.toDateString()==(new Date).toDateString()&&d("today",e);var f=this._getHoliday(b);switch(f!==!1&&d("holidays",e),b.getDay()){case 0:d("sunday",e);break;case 6:d("saturday",e)}return d(b.toDateString(),e),e.join(" ")},view:function(a){if(a){if(!this.options.views[a].enable)return;this.options.view=a}this._init_position(),this._loadEvents(),this._render(),this.options.onAfterViewLoad.call(this,this.options.view)},navigate:function(a,e){var g=f.extend({},this.options.position);if("next"==a)switch(this.options.view){case"year":g.start.setFullYear(this.options.position.start.getFullYear()+1);break;case"month":g.start.setMonth(this.options.position.start.getMonth()+1);break;case"week":g.start.setDate(this.options.position.start.getDate()+7);break;case"day":g.start.setDate(this.options.position.start.getDate()+1)}else if("prev"==a)switch(this.options.view){case"year":g.start.setFullYear(this.options.position.start.getFullYear()-1);break;case"month":g.start.setMonth(this.options.position.start.getMonth()-1);break;case"week":g.start.setDate(this.options.position.start.getDate()-7);break;case"day":g.start.setDate(this.options.position.start.getDate()-1)}else"today"==a?g.start.setTime((new Date).getTime()):f.error(d(this.locale.error_where,a));this.options.day=g.start.getFullYear()+"-"+b(g.start)+"-"+c(g.start),this.view(),h(e)&&e()},_init_position:function(){var a,b,c;if("now"==this.options.day){var e=new Date;a=e.getFullYear(),b=e.getMonth(),c=e.getDate()}else if(this.options.day.match(/^\d{4}-\d{2}-\d{2}$/g)){var g=this.options.day.split("-");a=parseInt(g[0],10),b=parseInt(g[1],10)-1,c=parseInt(g[2],10)}else f.error(d(this.locale.error_dateformat,this.options.day));switch(this.options.view){case"year":this.options.position.start.setTime(new Date(a,0,1).getTime()),this.options.position.end.setTime(new Date(a+1,0,1).getTime());break;case"month":this.options.position.start.setTime(new Date(a,b,1).getTime()),this.options.position.end.setTime(new Date(a,b+1,1).getTime());break;case"day":this.options.position.start.setTime(new Date(a,b,c).getTime()),this.options.position.end.setTime(new Date(a,b,c+1).getTime());break;case"week":var h,i=new Date(a,b,c);h=1==k(this,"first_day")?i.getDate()-(i.getDay()+6)%7:i.getDate()-i.getDay(),this.options.position.start.setTime(new Date(a,b,h).getTime()),this.options.position.end.setTime(new Date(a,b,h+7).getTime());break;default:f.error(d(this.locale.error_noview,this.options.view))}return this},getTitle:function(){var b=this.options.position.start;switch(this.options.view){case"year":return d(this.locale.title_year,b.getFullYear());case"month":return d(this.locale.title_month,this.locale["m"+b.getMonth()],b.getFullYear());case"week":return d(this.locale.title_week,a(b),b.getFullYear());case"day":return d(this.locale.title_day,this.locale["d"+b.getDay()],b.getDate(),this.locale["m"+b.getMonth()],b.getFullYear())}},isToday:function(){var a=(new Date).getTime();return a>this.options.position.start&&a<this.options.position.end},getStartDate:function(){return this.options.position.start},getEndDate:function(){return this.options.position.end},_loadEvents:function(){var a=this,b=null;"events_source"in this.options&&""!==this.options.events_source?b=this.options.events_source:"events_url"in this.options&&(b=this.options.events_url,m("The events_url option is DEPRECATED and it will be REMOVED in near future. Please use events_source instead."));var c;switch(f.type(b)){case"function":c=function(){return b(a.options.position.start,a.options.position.end,s)};break;case"array":c=function(){return[].concat(b)};break;case"string":b.length&&(c=function(){var c=[],d={from:a.options.position.start.getTime(),to:a.options.position.end.getTime()};return s.length&&(d.browser_timezone=s),f.ajax({url:j(b,d),dataType:"json",type:"GET",async:!1}).done(function(a){a.success||f.error(a.error),a.result&&(c=a.result)}),c})}c||f.error(this.locale.error_loadurl),this.options.onBeforeEventsLoad.call(this,function(){a.options.events=c(),a.options.events.sort(function(a,b){var c;return c=a.start-b.start,0==c&&(c=a.end-b.end),c}),a.options.onAfterEventsLoad.call(a,a.options.events)})},_templatePath:function(a){return"function"==typeof this.options.tmpl_path?this.options.tmpl_path(a):this.options.tmpl_path+a+".html"},_loadTemplate:function(a){if(!this.options.templates[a]){var b=this;f.ajax({url:b._templatePath(a),dataType:"html",type:"GET",async:!1,cache:this.options.tmpl_cache}).done(function(c){b.options.templates[a]=i(c)})}},_update:function(){var a=this;a.context.find("*[data-cal-date]").click(function(){var b=f(this).data("cal-view");a.options.day=f(this).data("cal-date"),a.view(b)}),a.context.find(".cal-cell").dblclick(function(){var b=f("[data-cal-date]",this).data("cal-view");a.options.day=f("[data-cal-date]",this).data("cal-date"),a.view(b)}),this["_update_"+this.options.view]()},_update_day:function(){this.context.find(".cal-day-panel").height(this.context.find(".cal-day-panel-hour").height())},_update_week:function(){},_update_year:function(){this._update_month_year()},_update_month:function(){this._update_month_year();var c=this,e=f(document.createElement("div")).attr("id","cal-week-box"),g=this.options.position.start.getFullYear()+"-"+b(this.options.position.start)+"-";c.context.find(".cal-month-box .cal-before-eventlist").on("mouseenter",function(){var b=new Date(c.options.position.start),h=f(".cal-cell:first-child .cal-month-day",this),i=h.hasClass("cal-month-first-row")?1:f("[data-cal-date]",h).text();b.setDate(parseInt(i)),i=10>i?"0"+i:i,e.html(d(c.locale.week,a(b))),e.attr("data-cal-week",g+i).show().appendTo(h)}).on("mouseleave",function(){e.hide()}),e.click(function(){c.options.day=f(this).data("cal-week"),c.view("week")}),f("a.event").mouseenter(function(){c.context.find('a[data-event-id="'+f(this).data("event-id")+'"]').closest(".cal-cell").addClass("day-highlight dh-"+f(this).data("event-class"))}).mouseleave(function(){c.context.find("div.cal-cell").removeClass("day-highlight dh-"+f(this).data("event-class"))})},_update_month_year:function(){if(this.options.views[this.options.view].slide_events){var a=this,b=f(document.createElement("div")).attr("id","cal-day-tick").html('<i class="icon-chevron-down glyphicon glyphicon-chevron-down"></i>');a.context.find(".cal-month-day, .cal-year-box .cal-cell").on("mouseenter",function(){0!=f(".events-list",this).length&&f(this).children("[data-cal-date]").text()!=a.activecell&&b.show().appendTo(this)}).on("mouseleave",function(){b.hide()}).on("click",function(d){0!=f(".events-list",this).length&&f(this).children("[data-cal-date]").text()!=a.activecell&&n(d,b,c,a)});var c=f(document.createElement("div")).attr("id","cal-slide-box");c.hide().click(function(a){a.stopPropagation()}),this._loadTemplate("events-list"),b.click(function(b){n(b,f(this),c,a)})}},getEventsBetween:function(a,b){var c=[];return f.each(this.options.events,function(){if(null==this.start)return!0;var d=this.end||this.start;parseInt(this.start)<b&&parseInt(d)>=a&&c.push(this)}),c}};g.addPlugin("calendar",p,u)}if("function"==typeof define&&define.amd)define(["jquery","jquery.plugincreator","lodash/lang/isFunction","lodash/string/template"],f);else{if("undefined"==typeof jQuery||"undefined"==typeof jQuery.addPlugin)throw"jQuery not defined";f(jQuery,jQuery,_)}}();